<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2018-01-05 Fri 00:41 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Emacs: Quick Hacks</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Narendra Joshi">
<link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css"/>
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Amaranth|Libre+Baskerville|Bree+Serif|Ubuntu+Mono|Pacifico&subset=latin,greek"/>
</head>
<body>
<div class="content-wrapper container">
   <div class="row"> <div class="col"> </div>   <div class="col-sm-6 col-md-8">
<div id="preamble" class="status">
<div class="banner">
    <a href="/"> Ramblings from a Corner </a>
  </div>
  <ul class="banner-links">
    <!--<li><a href="/archive.xml"> RSS </a> </li>--!>
    <li><a href="/archive.html"> Posts </a> </li>
  </ul>
  <hr>
</div>
<div id="content">
<div>
<h1 class="title">Emacs: Quick Hacks</h1>
</div><div id="outline-container-org5b1ba7a" class="outline-2">
<h2 id="org5b1ba7a"><a id="ID-da3c972c-02a3-4217-bdf9-d3adcd31f36b"></a>Intro</h2>
<div class="outline-text-2" id="text-org5b1ba7a">
<p>
I spend most of my time inside Emacs â€• the truly extensible environment. I keep
adding new functions/commands to my Emacs configuration that help me accomplish
just about anything I would like to. In this post, I am sharing with you two
such functions.
</p>
</div>
</div>
<div id="outline-container-org81dde6e" class="outline-2">
<h2 id="org81dde6e"><a id="ID-a2d1467f-8070-4d5f-b491-c9a80a038888"></a>Code</h2>
<div class="outline-text-2" id="text-org81dde6e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #909737;">defun</span> <span style="color: #385e6b;">do-when-idle</span> (f g interval)
  <span style="color: #7e9960;">"Call F when idle for INTERVAL seconds and then G when there is activity.</span>
<span style="color: #7e9960;">Thanks to Michael Heerdegen <a href="mailto:michael_heerdegen%40web.de">&lt;michael_heerdegen@web.de&gt;</a>."</span>
  (<span style="color: #909737;">letrec</span> ((run-timer-fun (<span style="color: #909737;">lambda</span> ()
                            (run-with-idle-timer interval
                                                 nil
                                                 (<span style="color: #909737;">lambda</span> ()
                                                   (funcall f)
                                                   (add-hook 'post-command-hook
                                                             activity-fun)))))
           (activity-fun (<span style="color: #909737;">lambda</span> ()
                           (remove-hook 'post-command-hook activity-fun)
                           (funcall g)
                           (funcall run-timer-fun))))
    (funcall run-timer-fun)))
</pre>
</div>

<p>
I use the above function for things like
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org9a9a1f6">(do-when-idle #'coin-ticker-mode
              (<span style="color: #909737;">lambda</span> ()
                (coin-ticker-mode -1))
              60)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #909737;">defvar</span> <span style="color: #ba5b34;">limit-usage</span> (make-hash-table <span style="color: #385e6b;">:test</span> 'equal))
(<span style="color: #909737;">defun</span> <span style="color: #385e6b;">limit-usage</span> (command max-minutes)
  <span style="color: #7e9960;">"Limit usage of COMMAND to only once in MAX-MINUTES."</span>
  (advice-add command
              <span style="color: #385e6b;">:around</span>
              `(<span style="color: #909737;">lambda</span> (orig-fn <span style="color: #909737;">&amp;rest</span> args)
                 (<span style="color: #909737;">let*</span> ((hash-key ,(symbol-name command))
                        (last-ts (gethash hash-key limit-usage))
                        (gap-in-minutes (<span style="color: #909737;">and</span> last-ts
                                             (/ (time-to-seconds
                                                 (time-subtract (current-time)
                                                                last-ts))
                                                60))))
                   (<span style="color: #909737;">if</span> (<span style="color: #909737;">and</span> gap-in-minutes (&lt; gap-in-minutes ,max-minutes))
                       (message <span style="color: #953331;">"Last Accessed: %s Time to go: %.2f minutes"</span>
                                (format-time-string <span style="color: #953331;">"%FT%T%z"</span> last-ts)
                                (- ,max-minutes gap-in-minutes))
                     (apply orig-fn args)
                     (puthash hash-key (current-time) limit-usage))))))

</pre>
</div>

<p>
I use the above function for limiting how frequently I check email:
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #505050;">;; </span><span style="color: #505050;">Check mail not more than once every 4 hour.</span>
(limit-usage #'gnus (* 4 60))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd46a9b0" class="outline-2">
<h2 id="orgd46a9b0"><a id="ID-8fa034d7-b883-48ba-8d10-aa446216bd45"></a>Conclusion</h2>
<div class="outline-text-2" id="text-orgd46a9b0">
<p>
Emacs is configurable in almost every aspect. Besides the advantages, the only
problem with it is that it encourages dislike for the defaults. This costs me
some time every week if not everyday.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<footer class="footer">
	<p> Built with
	  <svg id="i-heart" viewBox="0 0 32 32">
    	<path d="M4 16 C1 12 2 6 7 4 12 2 15 6 16 8 17 6 21 2 26 4 31 6 31 12 28 16 25 20 16 28 16 28 16 28 7 20 4 16 Z"/>
	  </svg> in
      <img id="i-emacs" src="/assets/images/emacs.svg">
	</p>
  </footer>
  <script type="text/javascript" src="/assets/js/custom.js"> </script>
  <script type="text/javascript" src="/assets/js/turbolinks.js"> </script>
</div>

</div>
<div class="col"></div></div>
</div>
</body>
</html>
